# API: Друзья

Эндпойнты для работы с дружбой между пользователями: отправка заявок, подтверждение, отклонение и получение списка друзей.

Все запросы выполняются к домену `https://{APP_DOMAIN_API}` и требуют авторизации:

`Authorization: Bearer {TOKEN}`

Где `{TOKEN}` — personal access token (см. `API_AUTH_FCM.md`).

---

## 1) Модель "Дружба" (`friendships`)

Поля:

- `id` — UUID записи дружбы
- `requester_id` — UUID пользователя, отправившего заявку
- `addressee_id` — UUID пользователя, получившего заявку
- `status` — статус заявки:
  - `pending` — заявка отправлена, ожидает подтверждения
  - `accepted` — заявка подтверждена, пользователи стали друзьями
- `created_at`, `updated_at`

Отклонённые заявки не хранятся — запись удаляется.

---

## 2) Эндпойнты: друзья

### 2.1) Получить список друзей

**GET** `/friends`

- Описание: возвращает всех пользователей, с которыми у текущего пользователя статус `accepted` (независимо от того, кто кому отправил заявку).
- Ответ:

```json
{
  "data": [
    {
      "id": "uuid",
      "name": "Имя",
      "email": "user@example.com",
      "about": "...",
      "gender": "...",
      "age": 30,
      "city": "Москва",
      "created_at": "...",
      "updated_at": "..."
    }
  ]
}
```

### 2.2) Отправить заявку в друзья

**POST** `/friends/requests`

Тело запроса (JSON):

```json
{
  "user_id": "uuid-пользователя"
}
```

- `user_id` — **обязательно**, должен существовать в таблице `users`.
- Нельзя отправить заявку самому себе.
- Нельзя отправить заявку, если:
  - пользователи уже являются друзьями;
  - между этими пользователями уже существует активная заявка (в любую сторону).

Ответ (201):

```json
{
  "message": "Заявка в друзья отправлена.",
  "data": {
    "id": "uuid-заявки",
    "requester_id": "uuid-отправителя",
    "addressee_id": "uuid-адресата",
    "status": "pending",
    "created_at": "...",
    "updated_at": "..."
  }
}
```

Возможные ошибки (422):

- Пользователь пытается добавить сам себя.
- Заявка уже существует или пользователи уже друзья.

### 2.3) Подтвердить заявку в друзья

**POST** `/friends/requests/{friendship}/accept`

- `friendship` — UUID существующей заявки, где текущий пользователь является адресатом (`addressee_id`).

Ответ:

```json
{
  "message": "Заявка в друзья принята.",
  "data": {
    "id": "uuid-друга",
    "name": "Имя",
    "email": "user@example.com"
  }
}
```

Ошибки:

- `403` — текущий пользователь не является адресатом заявки.
- `422` — заявку нельзя подтвердить (статус не `pending`).

### 2.4) Отклонить заявку в друзья

**POST** `/friends/requests/{friendship}/reject`

- `friendship` — UUID существующей заявки, где текущий пользователь является адресатом.
- При успешном отклонении запись удаляется из БД.

Ответ:

```json
{
  "message": "Заявка в друзья отклонена."
}
```
